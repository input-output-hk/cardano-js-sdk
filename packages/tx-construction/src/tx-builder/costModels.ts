import { Cardano, Serialization } from '@cardano-sdk/core';

export type TaggedCostModel = { version: Cardano.PlutusLanguageVersion; prices: number[] };

// LW-7691: Currently cost models come from the backend out of order and as an object rather than an array.
// for now, we will hard code them. We can do this since the cost models are the same for all public networks.
// However, replacing this hardcoded models for the ones in the protocol parameters should be a priority
// once LW-7691 is resolved.

export const plutusV1CostModel: TaggedCostModel = {
  prices: [
    205_665, 812, 1, 1, 1000, 571, 0, 1, 1000, 24_177, 4, 1, 1000, 32, 117_366, 10_475, 4, 23_000, 100, 23_000, 100,
    23_000, 100, 23_000, 100, 23_000, 100, 23_000, 100, 100, 100, 23_000, 100, 19_537, 32, 175_354, 32, 46_417, 4,
    221_973, 511, 0, 1, 89_141, 32, 497_525, 14_068, 4, 2, 196_500, 453_240, 220, 0, 1, 1, 1000, 28_662, 4, 2, 245_000,
    216_773, 62, 1, 1_060_367, 12_586, 1, 208_512, 421, 1, 187_000, 1000, 52_998, 1, 80_436, 32, 43_249, 32, 1000, 32,
    80_556, 1, 57_667, 4, 1000, 10, 197_145, 156, 1, 197_145, 156, 1, 204_924, 473, 1, 208_896, 511, 1, 52_467, 32,
    64_832, 32, 65_493, 32, 22_558, 32, 16_563, 32, 76_511, 32, 196_500, 453_240, 220, 0, 1, 1, 69_522, 11_687, 0, 1,
    60_091, 32, 196_500, 453_240, 220, 0, 1, 1, 196_500, 453_240, 220, 0, 1, 1, 806_990, 30_482, 4, 1_927_926, 82_523,
    4, 265_318, 0, 4, 0, 85_931, 32, 205_665, 812, 1, 1, 41_182, 32, 212_342, 32, 31_220, 32, 32_696, 32, 43_357, 32,
    32_247, 32, 38_314, 32, 57_996_947, 18_975, 10
  ],
  version: Cardano.PlutusLanguageVersion.V1
};

export const plutusV2CostModel: TaggedCostModel = {
  prices: [
    205_665, 812, 1, 1, 1000, 571, 0, 1, 1000, 24_177, 4, 1, 1000, 32, 117_366, 10_475, 4, 23_000, 100, 23_000, 100,
    23_000, 100, 23_000, 100, 23_000, 100, 23_000, 100, 100, 100, 23_000, 100, 19_537, 32, 175_354, 32, 46_417, 4,
    221_973, 511, 0, 1, 89_141, 32, 497_525, 14_068, 4, 2, 196_500, 453_240, 220, 0, 1, 1, 1000, 28_662, 4, 2, 245_000,
    216_773, 62, 1, 1_060_367, 12_586, 1, 208_512, 421, 1, 187_000, 1000, 52_998, 1, 80_436, 32, 43_249, 32, 1000, 32,
    80_556, 1, 57_667, 4, 1000, 10, 197_145, 156, 1, 197_145, 156, 1, 204_924, 473, 1, 208_896, 511, 1, 52_467, 32,
    64_832, 32, 65_493, 32, 22_558, 32, 16_563, 32, 76_511, 32, 196_500, 453_240, 220, 0, 1, 1, 69_522, 11_687, 0, 1,
    60_091, 32, 196_500, 453_240, 220, 0, 1, 1, 196_500, 453_240, 220, 0, 1, 1, 1_159_724, 392_670, 0, 2, 806_990,
    30_482, 4, 1_927_926, 82_523, 4, 265_318, 0, 4, 0, 85_931, 32, 205_665, 812, 1, 1, 41_182, 32, 212_342, 32, 31_220,
    32, 32_696, 32, 43_357, 32, 32_247, 32, 38_314, 32, 35_892_428, 10, 57_996_947, 18_975, 10, 38_887_044, 32_947, 10
  ],
  version: Cardano.PlutusLanguageVersion.V2
};

export const plutusV3CostModel: TaggedCostModel = {
  prices: [
    205_665, 812, 1, 1, 1000, 571, 0, 1, 1000, 24_177, 4, 1, 1000, 32, 117_366, 10_475, 4, 23_000, 100, 23_000, 100,
    23_000, 100, 23_000, 100, 23_000, 100, 23_000, 100, 100, 100, 23_000, 100, 19_537, 32, 175_354, 32, 46_417, 4,
    221_973, 511, 0, 1, 89_141, 32, 497_525, 14_068, 4, 2, 196_500, 453_240, 220, 0, 1, 1, 1000, 28_662, 4, 2, 245_000,
    216_773, 62, 1, 1_060_367, 12_586, 1, 208_512, 421, 1, 187_000, 1000, 52_998, 1, 80_436, 32, 43_249, 32, 1000, 32,
    80_556, 1, 57_667, 4, 1000, 10, 197_145, 156, 1, 197_145, 156, 1, 204_924, 473, 1, 208_896, 511, 1, 52_467, 32,
    64_832, 32, 65_493, 32, 22_558, 32, 16_563, 32, 76_511, 32, 196_500, 453_240, 220, 0, 1, 1, 69_522, 11_687, 0, 1,
    60_091, 32, 196_500, 453_240, 220, 0, 1, 1, 196_500, 453_240, 220, 0, 1, 1, 1_159_724, 392_670, 0, 2, 806_990,
    30_482, 4, 1_927_926, 82_523, 4, 265_318, 0, 4, 0, 85_931, 32, 205_665, 812, 1, 1, 41_182, 32, 212_342, 32, 31_220,
    32, 32_696, 32, 43_357, 32, 32_247, 32, 38_314, 32, 35_190_005, 10, 57_996_947, 18_975, 10, 39_121_781, 32_260, 10,
    100, 23_000, 100, 832_808, 18, 3_209_094, 6, 331_451, 1, 65_990_684, 23_097, 18, 114_242, 18, 94_393_407, 87_060,
    18, 16_420_089, 18, 2_145_798, 36, 3_795_345, 12, 889_023, 1, 204_237_282, 23_271, 36, 129_165, 36, 189_977_790,
    85_902, 36, 33_012_864, 36, 388_443_360, 1, 401_885_761, 72, 2_331_379, 72, 1_927_926, 82_523, 4, 117_366, 10_475,
    4, 1_292_075, 24_469, 74, 0, 1, 936_157, 49_601, 237, 0, 1
  ],
  version: Cardano.PlutusLanguageVersion.V3
};

export const buildCostModels = (models: TaggedCostModel[]): Cardano.CostModels => {
  const costModels = new Serialization.Costmdls();

  for (const model of models) {
    const costModel = new Serialization.CostModel(model.version, model.prices);

    costModels.insert(costModel);
  }

  return costModels.toCore();
};

export const getDefaultCostModelsForVersions = (versions: Array<Cardano.PlutusLanguageVersion>) => {
  const uniqueVersions = [...new Set(versions)];

  const models = uniqueVersions.map((version) => {
    switch (version) {
      case Cardano.PlutusLanguageVersion.V1:
        return plutusV1CostModel;
      case Cardano.PlutusLanguageVersion.V2:
        return plutusV2CostModel;
      case Cardano.PlutusLanguageVersion.V3:
        return plutusV3CostModel;
      default:
        throw new Error('Invalid plutus language');
    }
  });

  return buildCostModels(models);
};
