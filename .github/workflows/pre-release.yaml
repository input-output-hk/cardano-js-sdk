name: Pre-release

on:
  pull_request:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  wallet-e2e-tests:
    strategy:
      matrix:
        os: [ ubuntu-20.04 ]
    runs-on: ${{ matrix.os }}
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v2.3.3
        with:
          submodules: true

      - name: ðŸ§° Setup Node.js
        uses: actions/setup-node@v1
        with:
          node-version: 14.17

      - name: ðŸ”¨ Install & Build
        run: |
          yarn install --frozen-lockfile --non-interactive --logevel=error
          yarn build

      - name: ðŸ”¬ Test
        working-directory: packages/wallet
        env:
          BLOCKFROST_API_KEY: ${{ secrets.BLOCKFROST_API_KEY }}
          MNEMONIC_WORDS: ${{ secrets.MNEMONIC_WORDS }}
          NETWORK_ID: 0
          POOL_ID_1: pool1euf2nh92ehqfw7rpd4s9qgq34z8dg4pvfqhjmhggmzk95gcd402
          POOL_ID_2: pool1fghrkl620rl3g54ezv56weeuwlyce2tdannm2hphs62syf3vyyh
          STAKE_POOL_SEARCH_PROVIDER: stub
          WALLET_PASSWORD: ${{ secrets.WALLET_PASSWORD }}
          WALLET_PROVIDER: blockfrost
          TIME_SETTINGS_PROVIDER: stub_testnet
          TX_SUBMIT_PROVIDER: blockfrost
          TX_SUBMIT_HTTP_URL: http://stub
          OGMIOS_URL: ws://stub
          LOGGER_MIN_SEVERITY: debug
        run: |
          yarn test:e2e
